# Mail Agent Configuration Example
# Copy this file to config.yml and customize for your environment
#
# This is the main configuration file for Mailwarden, controlling all aspects
# of email processing, classification, and AI behavior.

# ============================================
# IMAP Server Settings
# ============================================
# Configure connection to your mail server via IMAP (secure)
imap:
  # IMAP server hostname or IP address
  host: mail.example.com
  
  # IMAP port (993 is standard for IMAPS/TLS)
  port: 993
  
  # Your email address / IMAP username
  username: user@example.com
  
  # Password options (choose ONE):
  # RECOMMENDED: Use environment variable for security
  # Set environment variable: export MAIL_PASSWORD="your-password"
  password_env: MAIL_PASSWORD
  
  # ALTERNATIVE: Specify password directly (less secure, avoid committing to git)
  # password: your-app-password
  
  # Optional: Display name used in From header of draft replies
  # Example: "John Doe" <user@example.com>
  # If not set, only email address is used
  from_name: Your Name
  
  # Optional: Email signature closing for draft replies
  # This is the phrase before your name in generated drafts
  # Options: 'Best regards', 'Kind regards', 'Sincerely', 'Cheers', etc.
  # Default: 'Best regards'
  signature_closing: Best regards
  
  # Use TLS encryption (STRONGLY RECOMMENDED - always true for port 993)
  use_tls: true
  
  # Verify SSL certificates (RECOMMENDED for security)
  # Only set to false for self-signed certificates in testing
  verify_ssl: true
  
  # Connection timeout in seconds
  # Increase if you have a slow connection or large mailbox
  timeout: 30

# ============================================
# Folder Mapping
# ============================================
# Define where different email categories should be moved
# These folders will be created automatically if they don't exist
#
# IMPORTANT: Folder separator depends on your IMAP server:
# - Gmail, Office365: Use "/" (e.g., "INBOX/Newsletters")
# - Some servers: Use "." (e.g., "INBOX.Newsletters")
# Mailwarden auto-detects and adjusts the separator
#
# For servers like Dovecot with "INBOX." prefix:
# - Just specify "Newsletters" → becomes "INBOX.INBOX.Newsletters"
# - Mailwarden handles the prefixing automatically
folders:
  # Main inbox (usually don't change this)
  inbox: INBOX
  
  # Marketing emails, mailing lists (auto-detected via List-Id header)
  newsletters: INBOX/Newsletters
  
  # Bills, receipts, payment confirmations
  invoices: INBOX/Invoices
  
  # Security alerts, system notifications, activation emails
  # NOTE: These are delayed 24h by default (see ai.delay_move_categories)
  alerts: INBOX/Alerts
  
  # Personal correspondence (friends, family)
  # NOTE: Delayed 24h by default to ensure you see them
  personal: INBOX/Personal
  
  # Work-related emails
  # NOTE: Delayed 24h by default
  work: INBOX/Work
  
  # Detected spam emails (moved immediately for safety)
  spam: Spam
  
  # Suspicious emails for manual review (high spam score but not certain)
  quarantine: INBOX/Quarantine
  
  # Emails that don't match any rule or AI classification
  # Manual review needed
  review: INBOX/Review
  
  # Long-term storage (not actively used by Mailwarden)
  archive: Archive

# ============================================
# Classification Rules
# ============================================
# Deterministic rules evaluated BEFORE AI classification
# Rules are checked in order - first match wins and stops evaluation
#
# Each rule can have:
# - name: Unique identifier for the rule
# - conditions: List of field checks (all must match if match_all: true)
# - match_all: true = AND logic, false = OR logic (default: false)
# - target_folder: Where to move matching emails
# - category: Email category for reporting
# - priority: low/normal/high (affects sorting in reports)
# - confidence: 0.0-1.0 (how sure we are, affects execution thresholds)
# - enabled: true/false (disable without deleting)
#
# Available fields for conditions:
# - from_domain: Sender's domain (e.g., "gmail.com")
# - from_addr: Full sender address
# - to_domain: Recipient's domain
# - subject: Email subject line
# - list_id: Mailing list identifier header
# - list_unsubscribe: Presence of unsubscribe link
# - reply_to: Reply-To header
#
# Pattern matching:
# - is_regex: true → Use regex patterns (e.g., "(?i)invoice|receipt")
# - is_regex: false → Simple substring match
rules:
  # ============================================
  # Newsletter Detection
  # ============================================
  - name: newsletter_by_list_id
    conditions:
      - field: list_id
        pattern: ".+"
        is_regex: true
    target_folder: INBOX/Newsletters
    category: newsletters
    priority: low
    confidence: 0.95
    enabled: true

  - name: newsletter_by_unsubscribe
    conditions:
      - field: list_unsubscribe
        pattern: ".+"
        is_regex: true
    match_all: true
    target_folder: INBOX/Newsletters
    category: newsletters
    priority: low
    confidence: 0.85

  # ============================================
  # Invoice Detection
  # ============================================
  - name: invoice_by_subject
    conditions:
      - field: subject
        pattern: "(?i)(invoice|factuur|rekening|receipt|payment\\s+confirmation|order\\s+confirmation)"
        is_regex: true
    target_folder: INBOX/Invoices
    category: invoices
    priority: high
    confidence: 0.85

  - name: invoice_from_known_vendors
    conditions:
      - field: from_domain
        pattern: "(?i)(paypal\\.com|stripe\\.com|amazon\\.|billing\\.)"
        is_regex: true
      - field: subject
        pattern: "(?i)(receipt|payment|order|invoice)"
        is_regex: true
    match_all: true
    target_folder: INBOX/Invoices
    category: invoices
    priority: high
    confidence: 0.90

  # ============================================
  # Alert Detection
  # ============================================
  - name: security_alerts
    conditions:
      - field: subject
        pattern: "(?i)(security\\s+alert|login\\s+attempt|new\\s+device|password\\s+changed|2fa|two-factor)"
        is_regex: true
    target_folder: INBOX/Alerts
    category: alerts
    priority: high
    confidence: 0.85

  - name: system_alerts
    conditions:
      - field: subject
        pattern: "(?i)(alert|warning|outage|incident|down|critical|urgent)"
        is_regex: true
      - field: from_domain
        pattern: "(?i)(monitoring|alerts|notify|status)"
        is_regex: true
    match_all: false
    target_folder: INBOX/Alerts
    category: alerts
    priority: high
    confidence: 0.80

  # GitHub notifications
  - name: github_notifications
    conditions:
      - field: from_domain
        pattern: github.com
    target_folder: INBOX/Alerts
    category: alerts
    priority: normal
    confidence: 0.95

  # GitLab notifications
  - name: gitlab_notifications
    conditions:
      - field: from_domain
        pattern: gitlab.com
    target_folder: INBOX/Alerts
    category: alerts
    priority: normal
    confidence: 0.95

  # ============================================
  # Work Email (customize domains)
  # ============================================
  # - name: work_by_domain
  #   conditions:
  #     - field: from_domain
  #       pattern: "(?i)(company\\.com|work\\.example\\.com)"
  #       is_regex: true
  #   target_folder: INBOX/Work
  #   category: work
  #   priority: normal
  #   confidence: 0.90

# ============================================
# Spam Detection Settings
# ============================================
# Four-layer spam detection system:
# 1. Header-based (SpamAssassin/Rspamd scores from mail server)
# 2. Heuristic analysis (sender mismatches, suspicious patterns)
# 3. Authentication (SPF/DKIM/DMARC failures)
# 4. DNS verification (MX records, SPF policy, disposable domains)
#
# Scores from all layers are combined into a total spam score
spam:
  # Master switch for spam detection (RECOMMENDED: true)
  enabled: true
  
  # === Layer 1: Header-based thresholds ===
  # SpamAssassin threshold (from X-Spam-Score header)
  # Scores above this are considered spam
  # Typical range: 3.0-7.0 (5.0 is common default)
  spamassassin_threshold: 5.0
  
  # Rspamd threshold (if your server uses Rspamd)
  # Higher = more strict
  rspamd_threshold: 10.0
  
  # === Layer 2: Heuristic weights (added to spam score) ===
  # Sender name doesn't match email address (spoofing indicator)
  # Example: From "PayPal" <phishing@evil.com>
  sender_mismatch_weight: 2.0
  
  # Reply-To domain differs from From domain (phishing indicator)
  # Example: From: legit@company.com, Reply-To: scam@evil.com
  reply_to_mismatch_weight: 1.5
  
  # Suspicious keywords in subject line
  # Examples: "URGENT", "VERIFY YOUR ACCOUNT", "CLICK HERE NOW"
  suspicious_subject_weight: 1.0
  
  # Too many links in email body (typically > 10)
  excessive_links_threshold: 10
  excessive_links_weight: 1.0
  
  # === Overall classification thresholds ===
  # Total score >= spam_threshold → Classified as SPAM
  # Typical range: 4.0-7.0
  spam_threshold: 5.0
  
  # Total score >= phishing_threshold → Classified as PHISHING
  # Should be higher than spam_threshold for more serious threats
  phishing_threshold: 7.0
  
  # Score range considered "uncertain" [min, max]
  # Emails in this range may trigger AI verification if enabled
  # Between these values = not clearly spam or not spam
  uncertain_range: [2.0, 5.0]

# ============================================
# DNS Verification - Active Sender Verification
# ============================================
# Layer 4 of spam detection: Performs LIVE DNS lookups to verify sender legitimacy
# This is INDEPENDENT of what your mail server already checked
#
# Why this matters:
# - Catches domains that can't receive email (no MX records)
# - Detects missing SPF policies (unauthorized senders)
# - Identifies disposable/temporary email services (80+ known providers)
# - Validates domain existence (catches typosquatting)
#
# All findings are added to the spam score for final classification
dns_verification:
  # Master switch for DNS verification
  # RECOMMENDED: true (adds strong anti-spam layer)
  enabled: true
  
  # === Individual checks (can be toggled) ===
  
  # Check if sender domain has MX (Mail Exchange) records
  # Domains without MX records can't receive email = suspicious
  # Example: scam@fakebankdomain.xyz (domain has no mail servers)
  check_mx: true
  
  # Check for SPF (Sender Policy Framework) records
  # SPF defines which servers are allowed to send email for a domain
  # Missing SPF = no sender authorization = higher spam risk
  check_spf: true
  
  # Check if sender uses a disposable/temporary email domain
  # Examples: tempmail.com, 10minutemail.com, guerrillamail.com
  # Database of 80+ known disposable providers
  check_disposable: true
  
  # === Weight adjustments for spam scoring ===
  # These weights are ADDED to the spam score when issues are found
  # Adjust based on your desired strictness
  
  # Penalty for no MX records (domain can't receive email = suspicious)
  # Range: 1.0-3.0, Recommended: 2.0
  no_mx_weight: 2.0
  
  # Penalty for no SPF record (email may not be authorized)
  # Range: 0.5-2.0, Recommended: 1.0
  no_spf_weight: 1.0
  
  # Penalty for disposable/temporary email domains
  # Range: 2.0-5.0, Recommended: 3.0 (these are often used for spam)
  disposable_weight: 3.0
  
  # Penalty for non-existent domain (NXDOMAIN DNS response)
  # Range: 3.0-10.0, Recommended: 5.0 (very suspicious)
  domain_not_exist_weight: 5.0
  
  # Trust score threshold below which email is suspicious (0.0 - 1.0)
  # Trust score combines all DNS checks
  # Below this threshold = additional spam points
  # Range: 0.2-0.5, Recommended: 0.3
  low_trust_threshold: 0.3
  
  # === Caching (reduces DNS queries and improves performance) ===
  
  # Cache DNS verification results
  # RECOMMENDED: true (avoids repeated lookups for same domains)
  cache_results: true
  
  # How long to cache results (hours)
  # DNS records don't change often, 24h is safe
  # Range: 1-168 (1 hour to 1 week), Recommended: 24
  cache_ttl_hours: 24

# ============================================
# Ollama - Local LLM Server Connection
# ============================================
# Mailwarden uses a local Ollama instance for AI classification
# No data leaves your network - all AI processing is local
#
# Setup: Install Ollama from https://ollama.ai and run:
#   ollama pull gemma2:27b  (or your preferred model)
#   ollama serve
ollama:
  # Ollama server address (can be localhost or remote server)
  # Examples:
  #   - http://localhost:11434 (local installation)
  #   - http://192.168.1.50:11434 (dedicated AI server)
  #   - http://ai-server.local:11434 (network server)
  host: http://localhost:11434
  
  # Port for Ollama API (default: 11434)
  port: 11434
  
  # LLM model to use for classification/drafts/summaries
  # Recommended models by size:
  #   - gemma2:9b (fast, 9GB RAM, good accuracy)
  #   - gemma2:27b (slower, 27GB RAM, excellent accuracy)
  #   - llama3:8b (fast, 8GB RAM, good for English)
  #   - mistral:7b (fast, 7GB RAM, balanced)
  # See available models: ollama list
  model: gemma3:27b
  
  # Temperature for LLM responses (0.0 = deterministic, 1.0 = creative)
  # Range: 0.0-1.0
  #   - 0.1-0.3: Consistent, factual (recommended for classification/spam detection)
  #   - 0.5-0.7: Balanced (good for summaries)
  #   - 0.8-1.0: Creative, varied (experimental)
  # This applies to classification, spam detection, and summaries
  temperature: 0.1
  
  # Temperature specifically for draft generation
  # Higher temperature = more creative/varied responses
  # Range: 0.0-1.0, Recommended: 0.6 (balanced creativity)
  #   - 0.3-0.5: Conservative, consistent drafts
  #   - 0.6-0.7: Natural, varied drafts (recommended)
  #   - 0.8-1.0: Very creative, experimental
  draft_temperature: 0.6
  
  # Maximum tokens for LLM response (controls response length)
  # Range: 100-2000
  #   - 200-500: Short responses (classification, summaries)
  #   - 500-1000: Medium responses (draft emails)
  #   - 1000-2000: Long responses (detailed analysis)
  max_tokens: 500
  
  # Request timeout in seconds
  # Increase for slower models or busy servers
  # Range: 30-300, Recommended: 60
  timeout: 60
  
  # Master switch for all AI features
  # Set to false to disable all AI classification, drafts, and summaries
  # Rules and spam detection will still work
  enabled: true

# ============================================
# AI Strategy - YOU control when AI is used!
# ============================================
# This section gives you FULL CONTROL over AI usage
# AI is OPTIONAL - rules and spam detection work without it
#
# AI can help with:
# 1. Classification - Categorize emails when rules don't match
# 2. Spam detection - Additional layer beyond SpamAssassin
# 3. Summaries - Generate email summaries for quick overview
# 4. Drafts - Generate reply suggestions for actionable emails
#
# Performance note: AI classification adds ~1-2 seconds per email
ai:
  # Master switch for all AI features
  # Set to false to disable all AI (rules and spam detection still work)
  enabled: true

  # ============================================
  # AI Classification - When to categorize emails with AI
  # ============================================
  
  # Always use AI for classification (ignores rule matches)
  # Use case: You want AI to analyze EVERY email regardless of rules
  # Performance: Slowest (AI runs for all emails)
  # RECOMMENDED: false (let rules handle obvious cases)
  always_classify: false
  
  # Use AI when no rule matches
  # Use case: Rules handle known senders/patterns, AI handles new/unknown emails
  # Performance: Medium (AI only for unmatched emails)
  # RECOMMENDED: true (best balance of speed and accuracy)
  classify_on_no_rule_match: true
  
  # Use AI to verify specific categories (even when rule matches)
  # Use case: Extra confidence for important categories
  # Example: Rule says "invoice" but AI can verify it's legitimate
  # Performance: Adds AI cost for these categories
  # RECOMMENDED: High-value categories (invoices, alerts)
  classify_categories:
    - invoices  # Verify invoices are legitimate (not phishing)
    - alerts    # Verify alerts are from real services

  # ============================================
  # AI Spam Detection - Additional spam/phishing layer
  # ============================================
  
  # Use AI for spam/phishing detection
  # This is INDEPENDENT of your mail server's SpamAssassin scores
  # AI analyzes content for phishing patterns, urgency tactics, etc.
  # RECOMMENDED: true (catches spam that bypasses traditional filters)
  detect_spam: true
  
  # Only use AI spam detection when heuristic score is uncertain
  # true: AI only runs when heuristic score is 3.0-7.0 (uncertain range)
  # false: AI ALWAYS runs for spam detection (slower but thorough)
  # RECOMMENDED: false if you want maximum protection
  spam_only_uncertain: false

  # ============================================
  # Email Organization - Delayed folder moves
  # ============================================
  # Prevents important emails from disappearing before you've seen them
  
  # Hours to wait after email is READ before moving to target folder
  # This keeps emails in your INBOX until you've opened them
  # After reading, they stay in INBOX for this many hours, then move
  # Range: 0-168 (0 = move immediately, 24 = wait 1 day, 168 = wait 1 week)
  # RECOMMENDED: 24 (gives you time to reply/act on the email)
  delay_move_hours: 24
  
  # Categories that get the delayed move treatment
  # Only emails in these categories will wait until you've read them
  # 
  # NOT affected by delay (move immediately):
  # - spam/phishing: ALWAYS moved immediately (for safety)
  # - newsletters: typically moved immediately (keep inbox clean)
  # 
  # Affected by delay (wait until read + delay_move_hours):
  # - personal: Important personal correspondence
  # - work: Work-related emails you need to act on
  # - alerts: Activation codes, security alerts, password resets
  # - invoices: Bills and receipts you need to review
  delay_move_categories:
    - personal    # Personal emails - wait until read
    - work        # Work emails - wait until read  
    - alerts      # Activation emails, security alerts - wait until read
    - invoices    # Invoices - wait until read
    # newsletters NOT in list - move immediately to keep inbox clean

  # ============================================
  # AI Capabilities - What can AI generate?
  # ============================================
  
  # Generate summaries for all processed emails
  # Summaries provide quick overview without reading full email
  # Cost: Adds ~1 second per email
  # RECOMMENDED: true (very useful for quick triage)
  generate_summaries: true
  
  # Generate draft responses for actionable emails
  # AI suggests replies for emails that need a response
  # Drafts are saved to your IMAP Drafts folder for review/editing
  # Uses configurable signature (from_name, signature_closing from imap section)
  # Cost: Adds ~2 seconds for actionable emails
  # RECOMMENDED: false initially (enable once you're comfortable with AI quality)
  # RECOMMENDED: false initially (enable once you're comfortable with AI quality)
  generate_drafts: false
  
  # Categories for which to generate draft responses
  # Drafts will only be generated for emails in these categories
  # RECOMMENDED: personal, work (where responses are needed)
  # NOT recommended: newsletters, spam (no responses needed)
  draft_categories:
    - personal  # Personal emails often need replies
    - work      # Work emails often need replies
  
  # ============================================
  # Advanced AI Features (Optional)
  # ============================================
  
  # Suggest priority level based on content analysis
  # AI analyzes urgency, importance, and context
  # Adds priority to email metadata (high/normal/low)
  # Cost: Minimal (uses same AI call as classification)
  # RECOMMENDED: true (helpful for email triage)
  suggest_priority: true
  
  # Extract action items from emails
  # AI identifies todo items, requests, deadlines
  # Example: "Please send me the report by Friday"
  # Cost: Adds ~0.5 seconds per email
  # RECOMMENDED: false (experimental feature)
  extract_actions: false
  
  # Detect language of email
  # AI identifies email language (en, nl, de, etc.)
  # Useful for international correspondence
  # Cost: Minimal (uses same AI call)
  # RECOMMENDED: false (unless you receive multi-language emails)
  detect_language: false
  
  # Analyze sentiment (positive/negative/neutral)
  # AI detects emotional tone of email
  # Example: Complaint email = negative, thank you email = positive
  # Cost: Minimal (uses same AI call)
  # RECOMMENDED: false (nice to have, not essential)
  analyze_sentiment: false

  # ============================================
  # Draft Generation Settings
  # ============================================
  
  # Tone for draft responses
  # Options: professional, friendly, formal, casual
  # - professional: Business appropriate, polite
  # - friendly: Warm but still professional
  # - formal: Very polite, suited for official correspondence
  # - casual: Relaxed, conversational
  # RECOMMENDED: professional
  draft_tone: professional
  
  # Language for drafts
  # Options: auto (match original email), nl, en, de, fr, etc.
  # auto: AI will match the language of the incoming email
  # RECOMMENDED: auto (unless you always reply in one language)
  draft_language: auto
  
  # Maximum words for draft response
  # Controls length of generated drafts
  # Range: 50-500
  #   - 50-100: Very short, brief acknowledgments
  #   - 100-200: Standard, professional responses
  #   - 200-500: Detailed, comprehensive responses
  # RECOMMENDED: 200
  draft_max_length: 200

  # ============================================
  # Performance & Cost Control
  # ============================================
  
  # Skip AI for emails older than N days
  # Useful for initial runs with large mailboxes
  # null = no limit (process all emails)
  # Example: 30 (only process emails from last 30 days)
  # RECOMMENDED: null for normal operation, 30 for initial setup
  skip_older_than_days: null
  
  # Maximum AI API calls per run
  # Safety limit to prevent runaway costs with paid APIs
  # null = no limit (recommended for local Ollama - no costs!)
  # Example: 100 (stop after 100 AI calls per run)
  # RECOMMENDED: null (Ollama is free, no need to limit)
  max_ai_calls_per_run: null
  
  # Cache AI results for similar emails
  # Avoids re-analyzing identical newsletters, alerts, etc.
  # Significantly improves performance for repetitive emails
  # RECOMMENDED: true
  cache_results: true
  
  # How long to cache AI results (hours)
  # Range: 1-168, Recommended: 24
  cache_ttl_hours: 24

# ============================================
# Processing Settings - Email Fetching & Batching
# ============================================
# Controls how emails are fetched and processed
processing:
  # Maximum emails to process per run
  # Safety limit to prevent excessive processing time
  # Range: 10-1000
  #   - 10-50: Conservative (fast runs, multiple runs may be needed)
  #   - 100-200: Balanced (good for daily processing)
  #   - 500-1000: Aggressive (for initial mailbox processing)
  # RECOMMENDED: 100
  max_messages_per_run: 100
  
  # Maximum email body size to fetch (bytes)
  # Larger bodies = better AI context but slower fetching
  # Range: 5000-100000
  #   - 5000-10000 (5-10KB): Minimal (for slow connections)
  #   - 50000 (50KB): Recommended (full context for most emails)
  #   - 100000 (100KB): Maximum (for very long emails)
  # RECOMMENDED: 50000 (50KB gives AI full context)
  max_body_bytes: 50000
  
  # Maximum characters for email snippet (fallback)
  # Used when fetch_body is false or body is too large
  # Range: 200-1000, Recommended: 500
  max_snippet_chars: 500
  
  # Fetch full email body (not just headers/snippet)
  # true: Fetch body for better AI classification (RECOMMENDED with local AI)
  # false: Only fetch headers and generate snippet (faster but less accurate)
  # 
  # With local Ollama: true (no cost, better results)
  # With paid APIs: false (to minimize data transfer costs)
  # RECOMMENDED: true
  fetch_body: true
  
  # Only process unseen (unread) emails
  # true: Skip emails you've already read (typical use case)
  # false: Process all emails regardless of read status (for testing/maintenance)
  # RECOMMENDED: true
  process_unseen_only: true
  
  # Use UID checkpoint system
  # Remembers last processed email UID to avoid re-processing
  # SQLite database stores checkpoints per folder
  # true: Only process new emails since last run (efficient)
  # false: Re-evaluate all emails every run (slow, high load)
  # RECOMMENDED: true
  use_uid_checkpoint: true
  
  # Number of emails to process in each batch
  # Larger batches = fewer IMAP round trips but more memory
  # Range: 5-50
  #   - 5-10: Conservative (low memory, more IMAP calls)
  #   - 10-20: Balanced (recommended)
  #   - 20-50: Aggressive (fast but high memory)
  # RECOMMENDED: 10
  batch_size: 10
  
  # Delay between IMAP operations (seconds)
  # Prevents overwhelming the mail server
  # Range: 0.0-2.0
  #   - 0.0: No delay (fast but aggressive)
  #   - 0.5: Balanced (recommended)
  #   - 1.0-2.0: Conservative (for slow/restricted servers)
  # RECOMMENDED: 0.5
  rate_limit_delay: 0.5

# ============================================
# Execution Mode - How changes are applied
# ============================================
# Three execution modes control what actions are actually performed
execution:
  # Execution mode - controls what happens to emails
  # Options:
  #   - dry-run: SAFE - Only simulate actions, nothing is changed
  #     Use for: Testing configuration, seeing what would happen
  #     Changes: NONE - everything is logged but not executed
  #   
  #   - review-only: SAFE - Read and classify, but don't move/flag emails
  #     Use for: Building confidence in AI decisions before acting
  #     Changes: NONE - decisions logged, no email modifications
  #   
  #   - active: LIVE - Execute all actions (move, flag, create drafts)
  #     Use for: Normal operation after testing
  #     Changes: FULL - emails are moved, flagged, drafts created
  # 
  # RECOMMENDED: Start with dry-run, then review-only, then active
  mode: dry-run
  
  # Minimum confidence score to execute actions (0.0 - 1.0)
  # Actions with lower confidence are logged but not executed
  # Range: 0.5-1.0
  #   - 0.5-0.7: Permissive (execute most actions)
  #   - 0.8: Balanced (recommended - high confidence required)
  #   - 0.9-1.0: Strict (only execute very certain actions)
  # RECOMMENDED: 0.8
  confidence_threshold: 0.8
  
  # Automatically apply rule-based actions
  # true: Rule matches are always applied (rules are trusted)
  # false: Even rule matches require confidence threshold
  # RECOMMENDED: true (rules are explicit and trusted)
  auto_apply_rules: true
  
  # Create a draft digest email summarizing all decisions
  # Sends you a summary of what Mailwarden did
  # false: No digest (just check logs)
  # true: Email digest sent after each run
  # RECOMMENDED: false (digests can be noisy)
  create_draft_digest: false

# ============================================
# Logging - Audit trail and debugging
# ============================================# ============================================
# Logging - Audit trail and debugging
# ============================================
# Configure logging for troubleshooting and audit compliance
logging:
  # Log level - controls verbosity of console/file output
  # Options:
  #   - DEBUG: Very verbose (shows all operations, API calls, decisions)
  #     Use for: Troubleshooting issues, development
  #   
  #   - INFO: Standard output (shows processing progress, decisions)
  #     Use for: Normal operation, monitoring
  #   
  #   - WARNING: Only warnings and errors (quiet)
  #     Use for: Production with minimal output
  #   
  #   - ERROR: Only errors (very quiet)
  #     Use for: Background operation, cron jobs
  # 
  # RECOMMENDED: INFO
  level: INFO
  
  # Main log file path (optional)
  # Uncomment to write logs to file instead of console
  # Example: /var/log/mailwarden/mailwarden.log (Linux)
  # Example: C:\logs\mailwarden.log (Windows)
  # RECOMMENDED: Leave commented for console output, or set for daemon mode
  # log_file: /var/log/mailwarden/mailwarden.log
  
  # Audit file - JSON Lines format for structured logging
  # Records all decisions and actions for compliance/review
  # Each line is a JSON object with: timestamp, email_id, decision, actions
  # Useful for: Reviewing AI decisions, troubleshooting, compliance
  # RECOMMENDED: Keep enabled (small overhead, valuable data)
  audit_file: audit.jsonl
  
  # Log sensitive data (passwords, email content)
  # false: Redact passwords, email bodies (RECOMMENDED)
  # true: Log everything (only for debugging, SECURITY RISK)
  # RECOMMENDED: false (never enable in production)
  log_secrets: false

# ============================================
# Watch Mode - Continuous monitoring with IMAP IDLE
# ============================================
# Real-time email processing using IMAP IDLE (push notifications)
# Alternative to running Mailwarden via cron
watch:
  # Enable watch mode (daemon mode)
  # true: Mailwarden runs continuously and monitors for new emails
  # false: Mailwarden processes once and exits (use with cron)
  # RECOMMENDED: true for always-on servers, false for scheduled runs
  enabled: true
  
  # IMAP IDLE timeout (seconds)
  # How long to wait for new email before re-establishing connection
  # RFC 2177 recommends max 1740 seconds (29 minutes)
  # Server typically closes connection after 30 minutes
  # Range: 300-1740
  # RECOMMENDED: 1740 (maximum efficiency)
  idle_timeout: 1740
  
  # Reconnection delay after connection error (seconds)
  # How long to wait before trying to reconnect
  # Range: 10-120
  #   - 10-30: Quick retry (for temporary network issues)
  #   - 30-60: Balanced (recommended)
  #   - 60-120: Conservative (for unstable connections)
  # RECOMMENDED: 30
  reconnect_delay: 30
  
  # Maximum consecutive reconnection attempts before giving up
  # After this many failures, Mailwarden will exit (let systemd/supervisor restart)
  # Range: 3-10
  # RECOMMENDED: 5 (gives several chances but prevents infinite loops)
  # RECOMMENDED: 5 (gives several chances but prevents infinite loops)
  max_reconnect_attempts: 5
  
  # Process existing unseen messages when starting watch mode
  # true: Process backlog of unread emails on startup (recommended)
  # false: Only process emails that arrive AFTER startup
  # RECOMMENDED: true (catches up on emails received while offline)
  process_on_startup: true
  
  # Log a heartbeat message every N seconds (shows daemon is alive)
  # Useful for monitoring that Mailwarden is still running
  # Range: 60-600
  #   - 60-120: Frequent (for testing, noisy logs)
  #   - 300: Balanced (every 5 minutes, recommended)
  #   - 600: Infrequent (every 10 minutes, quiet)
  # RECOMMENDED: 300 (every 5 minutes)
  heartbeat_interval: 300

# ============================================
# Database - SQLite storage for state
# ============================================
# Mailwarden uses SQLite to store:
# - UID checkpoints (last processed email per folder)
# - Processed email hashes (deduplication)
# - AI result cache
# - Audit log (optional, if audit_file not specified)
#
# Path can be absolute or relative to config file
# Examples:
#   - mailwarden.db (relative, creates in same directory as config)
#   - /var/lib/mailwarden/state.db (absolute, Linux)
#   - C:\ProgramData\Mailwarden\state.db (absolute, Windows)
#
# RECOMMENDED: Use absolute path for production, relative for development
database_path: mailwarden.db
